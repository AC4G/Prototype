{% extends 'baseDashboard.html.twig' %}

{% block body %}
    <div class="overflow-x-hidden overflow-y-scroll w-full h-[100vh]">
        <div class="h-[80px] w-full">
            <div class="h-[78px] w-[80%] mx-auto pt-[19.5px]">
                <p class="font-inter text-[26px] select-none">Profile</p>
            </div>
            <div class="relative mx-auto h-[2px] bg-[#ebebeb] w-[80%] rounded"></div>
        </div>
        <div class="flex max-w-[1000px] mx-auto h-fit pt-[40px]">
            <div class="relative w-full flex justify-evenly">
                <form action="{{ path('dashboard_profile') }}" method="post" enctype="multipart/form-data" name="profile-pic-form" class="h-fit">
                    <div class="w-fit">
                        <div class="w-fit h-[30px]">
                            <p class="font-inter text-[14px] select-none">Profile picture</p>
                        </div>
                        <div class="relative w-[124px] h-[124px] rounded-full bg-[#2e4053]">
                            <img src="{% if user.profilePic is not null %} {{ asset(user.profilePic) }} {% else %} {{ asset('files/profile/default.jpg') }} {% endif %}" class="relative top-[2px] left-[2px] object-cover w-[120px] h-[120px] rounded-full">
                            <div class="z-10 border-2 border-[#2e4053] bg-white hover:bg-[#2e4053] group absolute rounded w-[40px] h-[30px] left-[90px] top-[80px] transition" id="edit-prf-pic">
                                <input id="prf-pic-input" name="profile-picture" type="file" class="opacity-0 cursor-pointer w-[36px] h-[26px] absolute">
                                <input name="form-type" type="hidden" value="picture">
                                <div class="w-full h-full pt-[6px] pl-[10px]">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="bi bi-pencil fill-black group-hover:fill-white transition" viewBox="0 0 16 16">
                                        <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="absolute left-[0px] right-[0px] ml-auto mr-auto w-fit h-fit">
                        <div class="relative flex-none w-[260px] h-[360px] mx-auto bg-black opacity-0 z-0 rounded-lg transition-all" id="imgprwbox">
                            <div class="relative top-[10px] h-fit left-[80%]">
                                <button type="button" class="text-white" id="discardprfimg">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                    </svg>
                                </button>
                            </div>
                            <div id="picture-error" class="w-fit mx-auto pt-[0px] mt-[10px] h-[20px] hidden">
                                <p class="text-[12px] text-red">Only gif, jpeg, png and jpg are supported</p>
                            </div>
                            <div class="relative top-[20px] left-[30px] w-fit">
                                <img id="imgprw" class="object-cover w-[200px] h-[200px]" src="#">
                            </div>
                            <div id="img-submit-box" class="absolute bottom-[40px] w-full h-fit">
                                <div class="w-fit mx-auto">
                                    <div id="img-submit" class="relative h-fit">
                                        <button type="submit" class="border-2 border-[#17ddff] text-white h-[30px] w-[200px] rounded bg-[#06b6d4] hover:bg-[#17ddff] transition" id="saveprfimg">Save new profile picture</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <form id="form-privacy" action="{{ path('dashboard_profile') }}" method="post" enctype="application/x-www-form-urlencoded">
                    <div class="w-[124px]">
                        <p class="font-inter text-[14px] select-none">Profile privacy</p>
                    </div>
                    <div class="flex relative top-[30px]">
                        <p class="font-inter text-[18px] mr-[30px]">Public</p>
                        <input class="checked:accent-black" name="privacy" id="privacy" type="checkbox" {% if not user.isPrivate %} checked {% endif %}>
                    </div>
                    <input name="form-type" type="hidden" value="privacy">
                </form>
            </div>
        </div>
        <div class="relative w-full">
            <div class="mx-auto w-fit h-fit pt-[60px]">
                <div class="flex-none pb-[20px]">
                    <p class="font-inter text-[16px] select-none">Nickname</p>
                </div>
                <div class="relative flex-none rounded border-2 h-[40px] w-[460px] pt-[6px] pl-[10px]">
                    <p class="font-inter text-grey text-[16px]">{{ user.nickname }}</p>
                    <div id="nick-chg-button" class="absolute right-[-2px] top-[-2px] h-[40px] w-[40px] border-2 rounded pt-[10px] pl-[10px] cursor-pointer group hover:bg-[#2e4053] transition hover:border-[#888888]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="bi bi-pencil fill-black group-hover:fill-white transition" viewBox="0 0 16 16">
                            <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                        </svg>
                    </div>
                </div>
                <div id="nickname-change-box" class="absolute top-[0px] opacity-0 z-[-1] transition-all left-[0px] right-[0px] ml-auto mr-auto w-fit h-fit">
                    <div class="w-[360px] h-[400px] bg-black rounded w-full">
                        <div class="relative top-[10px] h-fit left-[80%]">
                            <button id="discardnickchg" type="button" class="text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                                    <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                </svg>
                            </button>
                        </div>
                        <form id="nick-chg-form" method="post" class="w-full">
                            <div class="">

                            </div>
                            <input type="text" name="" class="">
                            <input type="hidden" name="form-type" value="nickname">
                            <button type="submit" class="">Save your new nickname</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="relative w-full">
            <div class="mx-auto w-fit h-fit pt-[40px]">
                <div class="flex-none pb-[20px]">
                    <p class="font-inter text-[16px] select-none">Email</p>
                </div>
                <div class="relative flex-none rounded border-2 h-[40px] w-[460px] pt-[6px] pl-[10px]">
                    <p class="font-inter text-grey text-[16px]">{{ user.email }}</p>
                    <div class="absolute right-[-2px] top-[-2px] h-[40px] w-[40px] border-2 rounded pt-[10px] pl-[10px] cursor-pointer group hover:bg-[#2e4053] transition hover:border-[#888888]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="bi bi-pencil fill-black group-hover:fill-white transition" viewBox="0 0 16 16">
                            <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let prfpicinput = document.getElementById('prf-pic-input');
        let imgprwbox = document.getElementById('imgprwbox');
        let imgprw = document.getElementById('imgprw');
        let discardprfimg = document.getElementById('discardprfimg');
        let saveprfimg = document.getElementById('saveprfimg');
        let blur = document.getElementById('blur');
        const imgTypes = ['image/gif', 'image/jpeg', 'image/png', 'image/jpg'];
        let error = document.getElementById('picture-error');
        let imgSubmit = document.getElementById('img-submit');
        let imgSubmitBox = document.getElementById('img-submit-box');
        let nickchgbox = document.getElementById('nickname-change-box');
        let nickchgbutton = document.getElementById('nick-chg-button');
        let discardnickchg = document.getElementById('discardnickchg');

        nickchgbutton.addEventListener('click', function (){
            blur.style.opacity = '0.3'
            blur.style.zIndex = '100'
            nickchgbox.style.opacity = '1'
            nickchgbox.style.zIndex = '110'
        });

        prfpicinput.onchange = evt => {
            const [file] = prfpicinput.files
            if (file) {
                imgprw.src = URL.createObjectURL(file)
                blur.style.opacity = '0.3'
                blur.style.zIndex = '100'
                imgprwbox.style.opacity = '1'
                imgprwbox.style.zIndex = '110'

                if (!imgTypes.includes(file['type'])) {
                    error.style.display = 'block'
                    imgSubmit.style.pointerEvents = 'none'
                    imgSubmitBox.style.bottom = '22px'
                    imgSubmitBox.classList.add('cursor-not-allowed')
                }
            }
        }

        function setToDefault() {
            nickchgbox.style.zIndex = '-1'
            nickchgbox.style.opacity = '0'
            imgprwbox.style.zIndex = '0'
            imgprwbox.style.opacity = '0'
            blur.style.opacity = '0'
            blur.style.zIndex = '-1'
            error.style.display = 'none'
            imgSubmitBox.style.removeProperty('bottom')
            imgSubmit.style.removeProperty('pointer-events')
            imgSubmitBox.classList.remove('cursor-not-allowed')
        }

        blur.addEventListener('click', function handleClick() {
            setToDefault();
        });

        discardprfimg.addEventListener('click', function handleClick() {
            setToDefault();
        });

        discardnickchg.addEventListener('click', function () {
            setToDefault()
        });

    </script>
    <script>
        let privacy = document.getElementById('privacy');
        let form = document.getElementById('form-privacy');

        privacy.addEventListener('click', function handleClick() {
            form.submit();
        });
    </script>
{% endblock %}
